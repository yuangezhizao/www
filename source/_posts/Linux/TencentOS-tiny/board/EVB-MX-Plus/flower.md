---
title: 【IOT应用创新大赛】基于 EVB_MX_Plus 的盆栽土壤监测
date: 2020-4-20 22:38:46
tags:
  - TencentOS-tiny
  - EVB_MX_Plus
  - STM32L4
count: 1
os: 0
os_1: 10.0.17763.1158 2019-LTSC
browser: 0
browser_1: 78.0.3904.108 Stable
place: 新家
key: 86
---
    终于到 deadline 了草
<!-- more -->
## 0x00.前言
还记得推上的那张曲线图嘛，越临近`deadline`效率越高（雾
![RT](https://i1.yuangezhizao.cn/Win-10/20200420224201.jpg!webp)

## 0x01.简介
其实这阵子一直盯着`专栏`看有投稿文章的方向性，印象里上周直至昨天还只有`4`篇，今天突然多了数篇，看完大佬们已经提交的文章，感觉好多都是`LoRa`相关的
虽然当初比赛申请的时候并不知道`RoLa`是什么，但是看完大佬们的文章也算是明白了它的基本原理吧，传输距离比无限通信远多了可是印象里最深刻的一点了
最后说回自己申请的`32`板子，虽然是个半内行人但是拿到手也能看出这是一块好板子，~~拿到手真是爱不释手`hhh`~~

## 0x02.EVB_MX_Plus
配套的联网模块使用`ESP8266`模组，这个用的再熟悉不过了，也赠送了`RoLa`模组，但是在公开的覆盖图上并没有看到市内有覆盖，因此暂时仍旧使用前者
另外的拓展`E51`模块足够使用，也没有额外购买其他型号的（
板子拿到手的那个周末就照着例程成功对接上了，见[EVB_MX_Plus 对接腾讯云物联网开发平台](../qcloud-iot-explorer.html)，不得不说`物联网开发平台`是真的方便（除了因自己没看好烧错例程无法对接之外）
`demo`程序可以实现云端控制灯的开关（顺便吐槽下这个灯真是巨亮无比）
然后去看板子上的其他传感器：`温、湿、光`应有尽有，另外在例程里也看到了`DHT11`的适配，估计找个`PIN`接上就也能使用了
作为个人业余开发者，并没有接触过工业（商业）产品的经验。所以觉得应该致力于解决贴近自己现实生活中的需求
对于老生常谈的`温湿度监控`已经基于`NodeMCU`+`DHT11`实现，这里就围绕着另一个想法进行实现
去年`tb`上买了一盆文竹，但是因为种种原因（懒）要么是好几天没浇水，要么是一浇就浇多了……
本来刚拿到手的时候是绿绿的，到了现在已经变黄了，惨……因此决定监测植物的湿度，于是立即去`tb`购买传感器等相关配件
![6.94](https://i1.yuangezhizao.cn/Win-10/20200420225355.png!webp)

拿到手后首先来看`土壤湿度传感器`，这个传感器说到底是国内的场子自己生产的，引出的两根线接到另外一块比较器板子上
买的是`4 PIN`的，即除了输入的电源和地之外，输出既有`A`也有`D`，数字量`D`用的是`LM358`来比较电压大小，因此可以手动调节板子上的滑动变阻器来改变阈值
同时板子上除了电源的`LED`之外，另一个`LED`正是和`D`口状态同步的，这里毕竟要看数值，因此选择`A`口到开发板的`ADC1`上来测量其实际电压
电压拿到手之后还需要映射到湿度范围上，虽然实际关系可能不是近似于线性，但是这里还是当做近似于线性处理了
计算方法很简单，放空气中是`4V`（0%）左右，插水里面是`1V`（100%）左右
即：`soil_humi = (4000 - adValue) / 30;`
然后就是小水泵了，这玩楞插`5V`流速实在是太快了（主要还是花盆太小了），而且不清楚能不能加上负反馈调节（学过的《自动控制原理》还略有印象）

## 0x03.代码
还没整理完，暂不放出
[gh](https://github.com/yuangezhizao)
![编译通过！](https://i1.yuangezhizao.cn/Win-10/20200420234447.jpg!webp)
![串口助手](https://i1.yuangezhizao.cn/Win-10/20200420233903.jpg!webp)
![设备调试](https://i1.yuangezhizao.cn/Win-10/20200420234007.png!webp)

## 0x04.连线图
![v0.1](https://i1.yuangezhizao.cn/Redmi-K20Pro/IMG_20200414_223830.jpg!view)

## 0x05.小程序
源码自带小程序端了，照着模板不到半小时就能预览出来（顺便发现代码里明文`SECRET_ID`和`SECRET_KEY`……这个还是得拿`CAM`单独建个只读`API`密钥
![v0.1](https://i1.yuangezhizao.cn/Redmi-K20Pro/Screenshot_2020-04-20-23-27-38-752_com.tencent.mm.jpg!webp)

## 0x06.实验室站

## 0x07.HomeAssistant

## 0x08.后记
总的来说收获还是巨大的（`wx`群里都是巨佬，瑟瑟发抖……
未完待续……